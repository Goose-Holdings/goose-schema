<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Goose Export Schema</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #F46811;
      --ochre: #D18F36;
      --blue-deep: #093C4D;
      --grey: #CBCBCB;
      --eggplant: #302B32;
      --text: #E2E2E2;
      --panel: rgba(28,30,33,0.85);
      --font-small: 0.9em;
      --radius: 4px;
      --pad: 0.8em;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at 20% 25%, var(--eggplant), var(--blue-deep));
      color: var(--text);
      margin: 0;
      display: flex;
      min-height: 100vh;
      font-size: var(--font-small);
      line-height: 1.6;
    }

    .toc {
      position: fixed;
      top: 0; left: 0;
      width: 240px;
      height: 100vh;
      background: var(--panel);
      border-right: 1px solid rgba(255,255,255,0.05);
      box-shadow: 2px 0 8px rgba(0,0,0,0.4);
      padding: 2em 1.4em;
      display: flex;
      flex-direction: column;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .6em;
      font-family: 'JetBrains Mono', monospace;
      color: var(--orange);
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 1.5em;
    }

    .brand-logo {
      width: 34px; height: 34px;
    }

    .toc a {
      position: relative;
      color: var(--grey);
      opacity: 0.8;
      display: block;
      margin: .4em 0;
      text-decoration: none;
      transition: color .25s, opacity .25s, padding-left .25s;
      padding-left: 0;
    }

    .toc a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 60%;
      width: 2px;
      background: var(--orange);
      opacity: 0;
      transition: opacity .25s, height .25s;
    }

    .toc a:hover {
      color: var(--orange);
      opacity: 1;
      padding-left: 6px;
      text-shadow: 0 0 6px rgba(244,104,17,0.3);
    }

    .toc a:hover::before {
      opacity: 1;
      height: 90%;
    }

    .toc a.active {
      color: var(--orange);
      opacity: 1;
      text-shadow: 0 0 8px rgba(244,104,17,0.4);
    }

    #content {
      margin-left: 260px;
      padding: 2em 3em;
      max-width: 1800px;
      flex: 1;
    }

    details {
      background: rgba(40,43,47,0.9);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: var(--radius);
      padding: var(--pad);
      margin: 1em 0;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
      transition: border-color .3s, box-shadow .3s;
    }

    details[open] { border-color: var(--orange); box-shadow: 0 0 15px rgba(244,104,17,0.15); }

    summary {
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      color: var(--orange);
      display: flex;
      flex-direction: column;
      gap: .3em;
    }

    .summary-desc {
      color: var(--grey);
      font-family: 'Inter', sans-serif;
      font-size: .9em;
      opacity: .8;
      font-weight: 400;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.04);
    }

    th, td {
      padding: .6em .8em;
      text-align: left;
      font-size: .85em;
    }

    th {
      background: rgba(244,104,17,0.08);
      color: var(--ochre);
      text-transform: uppercase;
    }

    tr:nth-child(even) td { background: rgba(38,40,43,0.9); }

    td a {
      color: var(--orange);
      text-decoration: none;
    }

    td a:hover {
      color: var(--ochre);
      text-shadow: 0 0 4px rgba(244,104,17,0.3);
    }

    .enum {
      background: rgba(209,143,54,0.2);
      color: var(--ochre);
      padding: 2px 6px;
      border-radius: 4px;
      margin: 2px;
      display: inline-block;
      font-family: 'JetBrains Mono', monospace;
    }
  </style>
</head>
<body>
  <div class="toc">
    <div class="brand">
      <img src="goose_future.png" alt="Goose Logo" class="brand-logo">
      <span>Goose Export Schema</span>
    </div>
    <div id="toc-list"></div>
  </div>
  <div id="content"></div>

  <script>
    function openAndScrollTo(id) {
      const el = document.getElementById(id);
      if (el) {
        el.open = true;
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        el.classList.add('highlight');
        setTimeout(() => el.classList.remove('highlight'), 1500);
      }
    }

    async function loadSchema() {
      const res = await fetch('goose-schema.json');
      const { definitions } = await res.json();
      const toc = document.getElementById('toc-list');
      const content = document.getElementById('content');

      toc.innerHTML = Object.keys(definitions).sort().map(d =>
        `<a href="#" data-target="${d}">${d}</a>`
      ).join('');

      const renderTable = (props) => {
        const cols = ['Property', 'Type', 'Format', 'Enum', 'Reference', 'Description', 'Comment', 'Examples'];
        const rows = Object.entries(props).map(([name, p]) => `
          <tr>
            <td>${name}</td>
            <td>${p.type || ''}</td>
            <td>${p.format || ''}</td>
            <td>${(p.enum || []).map(e => `<span class="enum">${e}</span>`).join('')}</td>
            <td>${p.$ref ? `<a href="#" class="ref-link" data-ref="${p.$ref}">${p.$ref}</a>` : ''}</td>
            <td>${p.description || ''}</td>
            <td>${p.$comment || ''}</td>
            <td>${(p.examples || []).map(e => `<code>${e}</code>`).join('<br>')}</td>
          </tr>`).join('');
        return `<table><thead><tr>${cols.map(c => `<th>${c}</th>`).join('')}</tr></thead><tbody>${rows}</tbody></table>`;
      };

      content.innerHTML = Object.entries(definitions).sort().map(([name, def]) => `
        <details id="${name}">
          <summary>${name}${def.description ? `<span class="summary-desc">${def.description}</span>` : ''}</summary>
          ${renderTable(def.properties || {})}
        </details>
      `).join('');

      document.querySelectorAll('.toc a').forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          const id = link.getAttribute('data-target');
          document.querySelectorAll('.toc a').forEach(a => a.classList.remove('active'));
          link.classList.add('active');
          openAndScrollTo(id);
        });
      });

      document.querySelectorAll('.ref-link').forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          const ref = link.getAttribute('data-ref');
          const target = ref.match(/#\/definitions\/([^\/]+)/)?.[1] || ref.split('.')[0];
          openAndScrollTo(target);
        });
      });
    }
    loadSchema();
  </script>
</body>
</html>
